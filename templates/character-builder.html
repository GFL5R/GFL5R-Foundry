<form class="actor-sheet gfl5r-sheet container-fluid py-2 text-light" data-bs-theme="dark" autocomplete="off">
  <input type="hidden" name="buildType" value="human" />

  <div class="card bg-dark text-light">
    <div class="card-header d-flex flex-wrap justify-content-between align-items-center gap-2">
      <div>
        <div class="fw-bold">Character Builder — Human</div>
        <div class="small text-muted">Step {{step}} of 4</div>
      </div>
      <div class="d-flex flex-wrap gap-2">
        {{#each steps as |s|}}
          <span class="badge rounded-pill {{#if (eq ../step s.num)}}bg-primary{{else}}bg-secondary{{/if}}">{{s.num}}. {{s.label}}</span>
        {{/each}}
      </div>
    </div>

    <div class="card-body">
      {{#if (eq step 1)}}
        <div class="mb-3">
          <h3 class="h5 mb-2">Where are you from?</h3>
          <p class="text-muted mb-2">In the year 2070 most surviving Green Zones sit under the URNC, but people still hold onto nationality. Where you were born and raised shapes how others see you, and how you see the world.</p>
          <p class="text-muted mb-3">Every Commander begins with all Approaches at 1; your nationality grants +1 to two approaches.</p>
          <div class="row g-3">
            {{#each humanNationalities as |nat|}}
              <div class="col-12 col-md-6">
                <label class="card h-100 shadow-sm" role="button">
                  <div class="card-body d-flex align-items-start gap-2">
                    <input class="form-check-input mt-1" type="radio" name="human.nationality" value="{{nat.key}}" required {{#if (eq ../formValues.human.nationality nat.key)}}checked{{/if}} />
                    <div>
                      <div class="fw-semibold">{{nat.label}}</div>
                      <div class="small text-muted">Approaches: +1 {{nat.approachesText}}</div>
                    </div>
                  </div>
                </label>
              </div>
            {{/each}}
          </div>
        </div>
      {{/if}}

      {{#if (eq step 2)}}
        <div class="mb-3">
          <h3 class="h5 mb-2">What is your background?</h3>
          <p class="text-muted mb-2">Your background defines what you did before bounty hunting—military halls, corporate desks, scavenger runs, or mercenary contracts. It grants +1 to one approach and sets one starting skill.</p>
          <div class="row g-3">
            {{#each humanBackgrounds as |bg|}}
              <div class="col-12 col-md-6">
                <label class="card h-100 shadow-sm" role="button">
                  <div class="card-body d-flex align-items-start gap-2">
                    <input class="form-check-input mt-1" type="radio" name="human.background" value="{{bg.key}}" required {{#if (eq ../formValues.human.background bg.key)}}checked{{/if}} />
                    <div>
                      <div class="fw-semibold">{{bg.label}}</div>
                      <div class="small text-muted">Approach: +1 {{bg.approachLabel}} • Skill: {{bg.skillLabel}}</div>
                    </div>
                  </div>
                </label>
              </div>
            {{/each}}
          </div>
        </div>
      {{/if}}

      {{#if (eq step 3)}}
        <div class="mb-4">
          <h3 class="h5 mb-1">What path have you chosen?</h3>
          <p class="text-muted mb-2">Sooner or later you chose what kind of Commander you are. Select one Discipline—it's unlocked for you and becomes your starting slot.</p>
          <p class="text-muted mb-3">Drop your starting Discipline below; it will occupy slot 1.</p>
          <div class="drop-zone p-3 text-center" data-drop-target="discipline">
            <div class="fw-semibold">Drop a Discipline item here</div>
            {{#if selections.discipline}}
              <div class="mt-2">Selected: {{selections.discipline.name}}
                <button type="button" class="btn btn-link btn-sm text-danger" data-action="clear-drop" data-drop-key="discipline">Clear</button>
              </div>
            {{else}}
              <div class="text-muted small">Drag from sidebar or compendium.</div>
            {{/if}}
          </div>
        </div>

        <div class="mb-3">
          <h3 class="h6">How do you stand out?</h3>
          <p class="text-muted">Drop one Advantage (Distinction). It's the quality that elevates you above the rest.</p>
          <div class="drop-zone p-3" data-drop-target="advantage">
            <div class="fw-semibold">Drop Advantage here</div>
            {{#if selections.advantage}}
              <div class="mt-2">Selected: {{selections.advantage.name}}
                <button type="button" class="btn btn-link btn-sm text-danger" data-action="clear-drop" data-drop-key="advantage">Clear</button>
              </div>
            {{/if}}
            <div class="mt-2">
              <input class="form-control form-control-sm" type="text" name="human.advantageText" placeholder="Or type a custom advantage" value="{{formValues.human.advantageText}}" />
            </div>
          </div>
        </div>

        <div class="mb-3">
          <h3 class="h6">What holds you back?</h3>
          <p class="text-muted">Drop one Disadvantage (Adversity). It's the faultline that threatens to crack under pressure.</p>
          <div class="drop-zone p-3" data-drop-target="disadvantage">
            <div class="fw-semibold">Drop Disadvantage here</div>
            {{#if selections.disadvantage}}
              <div class="mt-2">Selected: {{selections.disadvantage.name}}
                <button type="button" class="btn btn-link btn-sm text-danger" data-action="clear-drop" data-drop-key="disadvantage">Clear</button>
              </div>
            {{/if}}
            <div class="mt-2">
              <input class="form-control form-control-sm" type="text" name="human.disadvantageText" placeholder="Or type a custom disadvantage" value="{{formValues.human.disadvantageText}}" />
            </div>
          </div>
        </div>

        <div class="row g-3">
          <div class="col-md-6">
            <h3 class="h6">What sets you apart?</h3>
            <p class="text-muted">Drop one Passion. This is the habit, interest, or fixation that marks you as yourself.</p>
            <div class="drop-zone p-3" data-drop-target="passion">
              <div class="fw-semibold">Drop Passion here</div>
              {{#if selections.passion}}
                <div class="mt-2">Selected: {{selections.passion.name}}
                  <button type="button" class="btn btn-link btn-sm text-danger" data-action="clear-drop" data-drop-key="passion">Clear</button>
                </div>
              {{/if}}
              <div class="mt-2">
                <input class="form-control form-control-sm" type="text" name="human.passionText" placeholder="Or type a custom passion" value="{{formValues.human.passionText}}" />
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <h3 class="h6">What do you fear?</h3>
            <p class="text-muted">Drop one Anxiety. It's the shadow you dread most.</p>
            <div class="drop-zone p-3" data-drop-target="anxiety">
              <div class="fw-semibold">Drop Anxiety here</div>
              {{#if selections.anxiety}}
                <div class="mt-2">Selected: {{selections.anxiety.name}}
                  <button type="button" class="btn btn-link btn-sm text-danger" data-action="clear-drop" data-drop-key="anxiety">Clear</button>
                </div>
              {{/if}}
              <div class="mt-2">
                <input class="form-control form-control-sm" type="text" name="human.anxietyText" placeholder="Or type a custom anxiety" value="{{formValues.human.anxietyText}}" />
              </div>
            </div>
          </div>
        </div>
      {{/if}}

      {{#if (eq step 4)}}
        <div class="mb-3">
          <h3 class="h5 mb-1">How do you view Dolls?</h3>
          <p class="text-muted">Your attitude shapes the bond. Respect makes them partners; seeing them as tools changes how you fight.</p>
          <div class="d-flex flex-column gap-2">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="human.viewDolls" id="view-dolls-favor" value="favor" {{#if (eq formValues.human.viewDolls "favor")}}checked{{/if}}>
              <label class="form-check-label" for="view-dolls-favor">They are partners/comrades (+5 Humanity)</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="human.viewDolls" id="view-dolls-tools" value="tools" {{#if (eq formValues.human.viewDolls "tools")}}checked{{/if}}>
              <label class="form-check-label" for="view-dolls-tools">They are tools (pick a skill to 1)</label>
            </div>
            <div class="ps-4">
              <label class="form-label small">Skill to raise if treating Dolls as tools</label>
              <select class="form-select" name="human.viewDollsSkill">
                <option value="">Select skill</option>
                {{#each skillOptions as |skill|}}
                  <option value="{{skill.key}}" {{#if (eq ../formValues.human.viewDollsSkill skill.key)}}selected{{/if}}>{{skill.label}}</option>
                {{/each}}
              </select>
            </div>
          </div>
        </div>

        <div class="mb-3">
          <h3 class="h6">What do you fight for?</h3>
          <p class="text-muted">Choose a personal goal that drives your Commander.</p>
          <textarea class="form-control" name="human.goal" rows="2" placeholder="Credits, rebuilding, revenge, legacy...">{{formValues.human.goal}}</textarea>
        </div>

        <div class="mb-3">
          <h3 class="h6">What does your name mean?</h3>
          <p class="text-muted">Inherited, gifted, earned, or chosen?</p>
          <textarea class="form-control" name="human.nameMeaning" rows="2">{{formValues.human.nameMeaning}}</textarea>
        </div>

        <div class="mb-3">
          <h3 class="h6">What is your name?</h3>
          <input class="form-control" type="text" name="human.name" value="{{#if formValues.human.name}}{{formValues.human.name}}{{else}}{{actorName}}{{/if}}" placeholder="Commander name" required />
        </div>

        <div class="mb-3">
          <h3 class="h6">How will your story end?</h3>
          <p class="text-muted">No mechanical effect—capture the vision you hold.</p>
          <textarea class="form-control" name="human.storyEnd" rows="2">{{formValues.human.storyEnd}}</textarea>
        </div>

        <div class="mb-3">
          <h3 class="h6">Notes</h3>
          <textarea class="form-control" name="human.additionalNotes" rows="3" placeholder="Anything else to capture?">{{formValues.human.additionalNotes}}</textarea>
        </div>
      {{/if}}
    </div>

    <div class="card-footer d-flex justify-content-between">
      <button type="button" class="btn btn-outline-secondary" data-action="builder-prev" {{#if (eq step 1)}}disabled{{/if}}>Back</button>
      <div class="d-flex gap-2">
        {{#if (eq step 4)}}
          <button type="submit" class="btn btn-primary">Apply to Sheet</button>
        {{else}}
          <button type="button" class="btn btn-primary" data-action="builder-next">Next</button>
        {{/if}}
      </div>
    </div>
  </div>
</form>
