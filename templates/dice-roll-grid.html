<section class="gfl5r-roll-grid gfl5r-sheet container-fluid py-3">
  <header class="mb-3 text-center text-md-start">
    <div class="text-muted small">TN {{tn}} · {{results.length}} dice</div>
  </header>

  <div class="row g-3 align-items-start roll-grid-columns">
    <div class="col-12 col-md-3">
      <div class="card h-100">
        <div class="card-header">Swap</div>
        <div class="card-body d-flex flex-column align-items-center roll-swap-zone" aria-label="Ring die faces">
          {{#each ringFaces as |face|}}
            <img
              src="{{face.icon}}"
              alt="{{face.label}}"
              class="roll-die-img swap"
              data-drag-die
              data-die-type="{{face.type}}"
              data-die-key="{{face.key}}"
              data-die-label="{{face.label}}"
              data-die-icon="{{face.icon}}"
              data-die-s="{{face.s}}"
              data-die-o="{{face.o}}"
              data-die-r="{{face.r}}"
              data-die-explosive="{{face.explosive}}"
            />
          {{/each}}
        </div>
      </div>
    </div>

    <div class="col-12 col-md-6">
      <div class="d-flex flex-column gap-3">
        <!-- Top row for Discard and Reroll -->
        <div class="row g-3">
          <div class="col-12 col-md-6">
            <div class="card h-100">
              <div class="card-header">Discard</div>
              <div class="card-body roll-drop-zone d-flex flex-wrap gap-2 justify-content-center align-items-center" data-drop-discard aria-label="Discard dice">
                {{#each discarded as |d|}}
                  <img
                    src="{{d.icon}}"
                    alt="{{d.label}}"
                    class="roll-die-img"
                    data-drag-die
                    data-from="discarded"
                    data-die-index="{{@index}}"
                    data-die-type="{{d.type}}"
                    data-die-key="{{d.key}}"
                    data-die-label="{{d.label}}"
                    data-die-icon="{{d.icon}}"
                    data-die-s="{{d.s}}"
                    data-die-o="{{d.o}}"
                    data-die-r="{{d.r}}"
                    data-die-explosive="{{d.explosive}}"
                  />
                {{/each}}
              </div>
            </div>
          </div>
          <div class="col-12 col-md-6">
            <div class="card h-100">
              <div class="card-header">Reroll</div>
              <div class="card-body roll-drop-zone d-flex flex-wrap gap-2 justify-content-center align-items-center" data-drop-reroll aria-label="Reroll dice">
                {{#each rerolled as |d|}}
                  <img
                    src="{{d.icon}}"
                    alt="{{d.label}}"
                    class="roll-die-img"
                    data-drag-die
                    data-from="rerolled"
                    data-die-index="{{@index}}"
                    data-die-type="{{d.type}}"
                    data-die-key="{{d.key}}"
                    data-die-label="{{d.label}}"
                    data-die-icon="{{d.icon}}"
                    data-die-s="{{d.s}}"
                    data-die-o="{{d.o}}"
                    data-die-r="{{d.r}}"
                    data-die-explosive="{{d.explosive}}"
                  />
                {{/each}}
              </div>
            </div>
          </div>
        </div>
        <!-- Middle: Rolled Dice -->
        <div class="card">
          <div class="card-header">Rolled Dice</div>
          <div class="card-body">
            <div class="row g-3 align-items-center justify-content-center flex-wrap roll-results-row">
              {{#each results as |d|}}
                <div class="col-auto text-center roll-die-slot" data-drop-die-index="{{@index}}">
                  <img
                    src="{{d.icon}}"
                    alt="{{d.label}}"
                    class="roll-die-img"
                    data-drag-die
                    data-from="results"
                    data-die-index="{{@index}}"
                    data-die-type="{{d.type}}"
                    data-die-key="{{d.key}}"
                    data-die-label="{{d.label}}"
                    data-die-icon="{{d.icon}}"
                    data-die-s="{{d.s}}"
                    data-die-o="{{d.o}}"
                    data-die-r="{{d.r}}"
                    data-die-explosive="{{d.explosive}}"
                  />
                </div>
              {{/each}}
            </div>
          </div>
        </div>
        <!-- Bottom: Keep -->
        <div class="card">
          <div class="card-header">Keep (max {{maxKeep}})</div>
          <div class="card-body roll-drop-zone d-flex flex-wrap gap-2 justify-content-center align-items-center" data-drop-keep aria-label="Kept dice">
            {{#each kept as |d|}}
              <div class="position-relative d-inline-block">
                <img
                  src="{{d.icon}}"
                  alt="{{d.label}}"
                  class="roll-die-img"
                  data-drag-die
                  data-from="kept"
                  data-die-index="{{@index}}"
                  data-die-type="{{d.type}}"
                  data-die-key="{{d.key}}"
                  data-die-label="{{d.label}}"
                  data-die-icon="{{d.icon}}"
                  data-die-s="{{d.s}}"
                  data-die-o="{{d.o}}"
                  data-die-r="{{d.r}}"
                  data-die-explosive="{{d.explosive}}"
                />
                {{#if d.explosion}}
                  <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning text-dark roll-explosion-badge">✨</span>
                {{/if}}
              </div>
            {{/each}}
          </div>
        </div>
        <!-- Continue Button -->
        <div class="mt-3 text-center">
          <button type="button" class="btn btn-primary roll-continue-btn" data-action="{{#if isFinalize}}finalize{{else}}continue{{/if}}" {{#unless canContinue}}disabled{{/unless}}>{{#if isFinalize}}Finalize{{else}}Continue{{/if}}</button>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-3">
      <div class="card h-100">
        <div class="card-header">Swap</div>
        <div class="card-body d-flex flex-column align-items-center roll-swap-zone" aria-label="Skill die faces">
          {{#each skillFaces as |face|}}
            <img
              src="{{face.icon}}"
              alt="{{face.label}}"
              class="roll-die-img swap"
              data-drag-die
              data-die-type="{{face.type}}"
              data-die-key="{{face.key}}"
              data-die-label="{{face.label}}"
              data-die-icon="{{face.icon}}"
              data-die-s="{{face.s}}"
              data-die-o="{{face.o}}"
              data-die-r="{{face.r}}"
              data-die-explosive="{{face.explosive}}"
            />
          {{/each}}
        </div>
      </div>
    </div>
  </div>

  <!-- Legend -->
  <div class="card mt-3 legend-card">
    <div class="card-header">Legend</div>
    <div class="card-body d-flex flex-wrap gap-3">
      <div class="d-flex align-items-center legend-entry">
        <img src="systems/gfl5r/assets/symbols/Success.svg" alt="Success" class="legend-icon"> Success
      </div>
      <div class="d-flex align-items-center legend-entry">
        <img src="systems/gfl5r/assets/symbols/Opportunity.svg" alt="Opportunity" class="legend-icon"> Opportunity
      </div>
      <div class="d-flex align-items-center legend-entry">
        <img src="systems/gfl5r/assets/symbols/Strife.svg" alt="Strife" class="legend-icon"> Strife
      </div>
      <div class="d-flex align-items-center legend-entry">
        <img src="systems/gfl5r/assets/symbols/Explosion.svg" alt="Explosion" class="legend-icon"> Explosion
      </div>
    </div>
  </div>
</section>
