<section class="actor-sheet gfl5r-sheet container-fluid py-3 text-light" data-bs-theme="dark">

  <header class="mb-4">
    <div class="row g-3 align-items-start">
      <div class="col-auto">
        <img class="img-thumbnail avatar-96" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" alt="{{actor.name}} portrait"/>
      </div>
      <div class="col">
        <div class="d-flex flex-column gap-3">
            <div>
              <label class="visually-hidden" for="actor-name">Character Name</label>
              <input id="actor-name" class="form-control form-control-lg fw-bold" name="name" type="text" value="{{actor.name}}" placeholder="Character Name" aria-label="Character name"/>
              {{#if originDisplay}}
                <div class="small text-muted mt-1">{{originDisplay}}</div>
              {{/if}}
            </div>
            <div class="row g-3 align-items-end">
              <div class="col-12 col-md-4">
                <label class="form-label pill-muted mb-1" for="char-type">Type</label>
                <select id="char-type" class="form-select" name="system.characterType" title="Character type affects available features">
                  {{selectOptions (object "human" "Human" "transhumanist" "Transhumanist" "doll" "Doll") selected=actor.system.characterType localize=false}}
                </select>
              </div>
              <div class="col-12 col-md-4">
                <label class="form-label pill-muted mb-1" for="humanity">Humanity</label>
                <input id="humanity" class="form-control" type="number" name="system.humanity" value="{{actor.system.humanity}}" min="0" aria-label="Humanity"/>
              </div>
              <div class="col-12 col-md-4">
                <label class="form-label pill-muted mb-1" for="fame">Fame</label>
                <input id="fame" class="form-control" type="number" name="system.fame" value="{{actor.system.fame}}" min="0" aria-label="Fame"/>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-3">
          <label class="form-label pill-muted mb-1 d-block" for="xp">Experience</label>
          <input id="xp" class="form-control form-control-lg text-end" type="number" name="system.xp" value="{{actor.system.xp}}" min="0" aria-label="Experience points" />
        <div class="small text-muted mt-1">Saved XP</div>
        <div class="mt-2 d-flex justify-content-md-end">
          <button type="button" class="btn btn-outline-light btn-sm" data-action="open-character-builder" title="Guided character creation">
            <i class="fas fa-magic me-1"></i> Character Creation
          </button>
        </div>
      </div>
    </div>
  </header>

  <section class="row g-4 mb-4">
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-header fw-semibold">Approaches</div>
        <div class="card-body">
          <div class="d-flex flex-wrap gap-3">
            {{#each approachesList as |approach|}}
              <div class="card skill-card flex-grow-1 min-w-220" data-approach-card data-approach-key="{{approach.key}}">
                <div class="card-body">
                  <div class="d-flex flex-column">
                    <div class="fw-semibold">{{approach.label}}</div>
                  </div>
                  <div class="d-flex align-items-center gap-2">
                    <button type="button" class="btn btn-outline-light btn-sm" data-action="approach-decrease" data-approach="{{approach.key}}" title="Refund last rank">-</button>
                    <span class="skill-rank-display">{{approach.value}}</span>
                    <button type="button" class="btn btn-primary btn-sm" data-action="approach-increase" data-approach="{{approach.key}}" title="Buy next rank">+</button>
                  </div>
                </div>
              </div>
            {{/each}}
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-header fw-semibold text-end">State</div>
        <div class="card-body">
          <div class="d-flex flex-column gap-2 align-items-end">
            <div class="w-100">
              <div class="d-flex justify-content-between align-items-center mb-1">
                <div class="pill-muted">Fatigue</div>
                <div class="fw-semibold">
                  <div class="d-flex gap-1 align-items-end">
                    <input id="fatigue" class="form-control form-control-sm text-end w-90" type="number" name="system.resources.fatigue" value="{{actor.system.resources.fatigue}}" min="0" aria-label="Fatigue"/>
                    <span class="align-self-center fs-4">/</span>
                    <input id="fatigue-capacity" class="form-control form-control-sm text-end w-90" type="text" value="{{fatigue.capacity}}" disabled aria-label="Fatigue"/></div>
                  </div>
              </div>
              <progress class="fatigue-bar" style="accent-color: {{fatigue.barColor}}" value="{{fatigue.current}}" max="{{fatigue.capacity}}" aria-valuetext="{{fatigue.current}} of {{fatigue.capacity}}"></progress>
            </div>
            <div class="w-100">
              <div class="d-flex justify-content-between align-items-center mb-1">
                <div class="pill-muted">Strife</div>
                <div class="fw-semibold">
                  <div class="d-flex gap-1 align-items-end">
                    <input id="strife" class="form-control form-control-sm text-end w-90" type="number" name="system.resources.strife" value="{{actor.system.resources.strife}}" min="0" aria-label="Strife"/>
                    <span class="align-self-center fs-4">/</span>
                    <input id="strife-capacity" class="form-control form-control-sm text-end w-90" type="text" value="{{strife.capacity}}" disabled aria-label="Strife capacity"/>
                  </div>
                </div>
              </div>
              <progress class="strife-bar" style="accent-color: {{strife.barColor}}" value="{{strife.current}}" max="{{strife.capacity}}" aria-valuetext="{{strife.current}} of {{strife.capacity}}"></progress>
            </div>
            <div class="d-flex flex-row gap-3 align-items-end">
              <div>
                <label class="form-label mb-1" for="vigilance">Vigilance</label>
                <input id="vigilance" class="form-control form-control-sm text-end" type="text" value="{{derived.vigilance}}" disabled aria-label="Vigilance"/>
              </div>
              <div>
                <label class="form-label mb-1" for="focus">Focus</label>
                <input id="focus" class="form-control form-control-sm text-end" type="text" value="{{derived.focus}}" disabled aria-label="Focus"/>
              </div>
              <div>
                <label class="form-label mb-1" for="fortune-current">Fortune Points</label>
                <div class="d-flex align-items-center gap-1">
                  <input id="fortune-current" class="form-control form-control-sm text-end w-80" type="number" name="system.resources.fortunePoints" value="{{actor.system.resources.fortunePoints}}" min="0" aria-label="Fortune points current"/>
                  <span class="align-self-center fs-4">/</span>
                  <input id="fortune-max" class="form-control form-control-sm text-end w-80" type="text" value="{{derived.fortunePointsMax}}" disabled aria-label="Fortune points maximum"/>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <ul class="nav nav-tabs tabs" data-group="primary">
    <li class="nav-item"><a class="nav-link active item" data-tab="skills">Skills</a></li>
    <li class="nav-item"><a class="nav-link item" data-tab="disciplines">Disciplines</a></li>
    {{#if showModules}}
      <li class="nav-item"><a class="nav-link item" data-tab="modules">Modules</a></li>
    {{/if}}
    <li class="nav-item"><a class="nav-link item" data-tab="status">Status</a></li>
    <li class="nav-item"><a class="nav-link item" data-tab="combat">Combat</a></li>
    <li class="nav-item"><a class="nav-link item" data-tab="inventory">Inventory</a></li>
    <li class="nav-item"><a class="nav-link item" data-tab="narrative">Narrative</a></li>
  </ul>

  <section class="tab-content sheet-body mt-0">
    {{> actor-sheet-skills}}
    {{> actor-sheet-disciplines}}
    {{> actor-sheet-modules}}
    {{> actor-sheet-status}}
    {{> actor-sheet-combat}}
    {{> actor-sheet-inventory}}
    {{> actor-sheet-narrative}}
  </section>
</section>